# initialising route et DNS

# sur cli76ai   a refaire a chaque reboot
echo 1 > /proc/sys/net/ipv4/ip_forward

iptables -t nat -A POSTROUTING -j MASQUERADE




# sur xosN
ip route show
ip route del default
ip route add default via 10.7.0.1 dev eth0
ip route show
# must see
#  239.2.11.0/24 dev eth0  scope link 
#  10.7.0.0/24 dev eth0  proto kernel  scope link  src 10.7.0.101  metric 10 
#  169.254.0.0/16 dev eth0  scope link  metric 10 
# default via 10.7.0.1 dev eth0 
ping 130 98 4 1
# must ping

# DNS

resolvconf -d eth0
resolvconf -a eth0
nameserver 130.98.18.18


cat /etc/resolv.conf
# Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)
#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN
nameserver 130.98.18.18



ping cli70bi.der.edf.fr
# should be ok



#----------------------------------------------
# setting package connection
#----------------------------------------------


cat << EOF > /etc/wgetrc
http_proxy=http://130.98.220.76:3128/
proxy-user=samuel.kortas
proxy-passwd=xxxxxxxxxxxx
use_proxy=on
EOF

cat /etc/wgetrc


urpmi.addmedia --wget xtreemos http://xtreemos:F_z3M]7qz@ftp.ext.mandriva.com/xtreemos/packages/i586/2008.0/RPMS
urpmi --wget --auto-update


installation subversion
urpmi subversion



cd /root


svn co https://clasz013.cla.edfgdf.fr/svn/osis/trunk/NOTES
cd NOTES
svn co https://clasz013.cla.edfgdf.fr/svn/osis/trunk/CONFIG

cd
ln -s NOTES/CONFIG/emacs.XOS .emacs
ln -s NOTES/CONFIG/bashrc.XOS .bashrc





# CREATE CRT

urpmi rootca-config-0.9.3-2mdv2008.0.noarch.rpm 


cd /root/SCRIPTS
init-rootca /opt/xtreemosca
cp create-rootca-creds.conf /etc/xos/config/openssl/
y
create-rootca-creds /opt/xtreemosca/
mkdir /etc/xos/truststore/public
create-rootca-creds /etc/xos/truststore/
cp /etc/xos/truststore/public/xtreemos.crt /etc/xos/truststore/certs/xtreemos.crt
y



# CREATE CSR




cd /CD0/updates/
ls
urpmi create-csr-0.9.4-1mdv2008.0.noarch.rpm 

cd /root/SCRIPTS
create-csr xos1.edf.fr "EDF" cda
cp xos1.edf.fr-cda.crt /etc/xos/truststore/certs/cda.crt
y
cp xos1.edf.fr-cda.key /etc/xos/truststore/private/cda.key
y
process-csr /opt/xtreemosca xos1.edf.fr-cda.csr 
y
y
c_rehash /etc/xos/truststore/certs/
ls
cp  volife.properties /etc/xos/config/volife/volife.properties 
y

# rca server stuff

create-csr xos1.edf.fr "EDF" rca
cp xos1.edf.fr-rca.crt /etc/xos/truststore/certs/rcaserver.crt
y
cp xos1.edf.fr-rca.key /etc/xos/truststore/private/rcaserver.key
y
process-csr /opt/xtreemosca xos1.edf.fr-rca.csr 
y
y
c_rehash /etc/xos/truststore/certs/
view-xos-cert /etc/xos/truststore/certs/rcaserver.crt


# create VO

/usr/share/xvoms/bin/xvoms_prepare_database.sh

# start CDA server

/sbin/service cdaserver restart

# use CDA Client

get-xos-cert localhost:6730 vo1 vouser.key vouser.crt test


echo checking....

view-xos-cert vouser.crt

echo getting VO

cat vouser.crt

view-xos-cert vouser.crt | awk '/GlobalPrimaryVOName/,/GlobalSecondaryVONames/ {gsub(/^ */,""); i++; if (i==2) { print $0}}' > myVO


cat myVO







